<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Wheel of Names Pro</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="icon" href="{{ asset('assets/images/logo-icon.png') }}" type="image/png" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
body {
  margin:0; font-family:'Segoe UI',Arial,sans-serif; background:#2a2a2a; color:#fff;
  overflow-x:hidden;
}
.container {
  display:flex; flex-wrap:wrap; justify-content:center; position:relative;
}
.wheel-wrapper {
  flex:1; display:flex; flex-direction:column; align-items:center; position:relative;
  min-width:300px; max-width:calc(100% - 320px);
  margin-top:80px;
}
canvas#wheel {
  background:#fff; border-radius:50%; box-shadow:0 10px 30px rgba(0,0,0,0.5); cursor:pointer;
}
.header {
  display:flex; justify-content:space-between; align-items:center; width:100%;
  position:fixed; top:0; left:0; right:0; background:#2a2a2a; z-index:10; padding:10px 20px;
  box-shadow:0 4px 10px rgba(0,0,0,0.4);
}
.header h1 { font-size:24px; margin:0; }
.controls { display:flex; flex-wrap:wrap; gap:6px; align-items:center; }
.checkbox-label { display:flex; align-items:center; gap:6px; font-size:13px; cursor:pointer; }
.fullscreen-btn {
  background: #444; border:none; padding:6px 10px; border-radius:8px; cursor:pointer; color:#fff; font-size:18px;
  transition:0.3s;
}
.fullscreen-btn:hover { background:#666; }
.sidebar {
  position:fixed; top:80px; right:20px; width:290px; max-height:calc(100vh - 100px); overflow:hidden;
  display:flex; flex-direction:column; z-index:5; background:#1f1f1f; border-radius:16px; box-shadow:0 10px 25px rgba(0,0,0,0.5);
}
.tabs { display:flex; border-bottom:1px solid rgba(255,255,255,0.2); }
.tab { flex:1; text-align:center; padding:12px; cursor:pointer; font-weight:bold; background:#1f1f1f; position:relative; }
.tab.active { background:#333; }
.tab .badge { background:#555; border-radius:12px; padding:2px 6px; font-size:12px; margin-left:6px; }
.tab-content { flex:1; overflow-y:auto; max-height:400px; padding:12px; }
.editable-list {
  width:100%; height:300px; font-size:14px; line-height:1.4; background:#2b2b2b; color:#fff;
  border-radius:12px; padding:10px; overflow-y:auto;
}
.btn-enhanced {
  background: linear-gradient(135deg, #4a90e2, #357ABD);
  border: none; border-radius: 10px; padding: 10px 16px;
  font-size: 14px; color: #fff; font-weight: bold;
  cursor: pointer; display:flex; align-items:center; gap:6px; transition:0.3s;
}
.btn-enhanced:hover {
  background: linear-gradient(135deg, #357ABD, #1f5ca5);
  transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.3);
}
.modal { position:fixed; inset:0; background:rgba(0,0,0,0.7); display:none; justify-content:center; align-items:center; z-index:999; }
.modal.active { display:flex; }
.modal-content {
  background:#fff; color:#000; padding:30px; border-radius:20px; text-align:center; width:90%; max-width:420px;
}
.winner-name { font-size:28px; font-weight:bold; margin:20px 0; }
#historyList { list-style:none; padding:0; margin:0; }
#historyList li { background:#333; margin:4px 0; padding:6px 12px; border-radius:12px; }
.center-circle {
  position:absolute;
  left:50%;
  top:50%;
  transform:translate(-50%,-50%);
  width:100px;
  height:100px;
  border-radius:50%;
  background:#4a90e2; 
  cursor:pointer;
  transition:0.3s;
}
.center-circle:hover { background:#357ABD; }
.center-circle i { font-size:28px; color:#fff; transition:0.3s; }
.modal-content .btn-secondary, .modal-content .btn-danger { padding:8px 16px; border:none; border-radius:10px; font-weight:bold; cursor:pointer; transition:0.3s; }
.modal-content .btn-secondary { background:#777; color:#fff; }
.modal-content .btn-secondary:hover { background:#555; }
.modal-content .btn-danger { background:#d9534f; color:#fff; }
.modal-content .btn-danger:hover { background:#c9302c; }
#wheel-pointer {
  position: absolute;
  left: 50%;
  top: -15px;
  transform: translateX(-50%);
  width: 0;
  height: 0;
  border-left: 15px solid transparent;
  border-right: 15px solid transparent;
  border-top: 30px solid red;
  z-index: 5;
}

/* Fully responsive for mobile */
@media (max-width: 991.98px) {
  body { font-size: 14px; }
  
  .header {
    flex-direction: column;
    align-items: center;
    text-align: center;
    gap: 8px;
  }

  .controls {
    flex-wrap: wrap;
    justify-content: center;
    gap: 8px;
  }

 .container {
    margin-top: 120px; /* Adjust depending on header height */
    flex-direction: column;
    align-items: center;
}

  .wheel-wrapper {
    max-width: 95vw;
    margin-top: 20px;
  }

  canvas#wheel {
    width: 90vw !important;
    height: 90vw !important;
  }

  .center-circle {
    width: 70px;
    height: 70px;
  }

 .sidebar {
    position: relative;
    width: 90%;
    max-width: 350px;
    margin: 20px auto 0; /* top margin 20px, centered horizontally */
    border-radius: 12px;
    padding: 10px;
}

  .tab-content {
    max-height: 200px;
    overflow-y: auto;
    padding: 6px;
  }

  .editable-list {
    height: 180px;
    font-size: 13px;
  }

  .winner-name {
    font-size: 22px;
    word-break: break-word;
  }

  .btn-enhanced, .modal-content .btn-secondary, .modal-content .btn-danger {
    font-size: 13px;
    padding: 8px 12px;
  }

  #wheel-pointer {
    top: -12px;
    border-left: 12px solid transparent;
    border-right: 12px solid transparent;
    border-top: 24px solid red;
  }
}
</style>
</head>
<body>

<input type="hidden" id="preselectName" value='["Jomar Daria","Roderick Valdez","MEMO"]'>

<div class="header">
  <h1>Wheel of Names</h1>
  <div class="controls">
    <button class="fullscreen-btn" onclick="toggleFullscreen()" title="Fullscreen"><i class="fas fa-expand"></i></button>
    <label class="checkbox-label"><input type="checkbox" id="soundToggle" checked> Sound</label>
    <label>Spin Time <input type="range" id="spinTime" min="6" max="14" value="10"></label>
  </div>
</div>

<div class="container">
  <div class="wheel-wrapper">
    <canvas id="wheel"></canvas>
    <div id="wheel-pointer"></div>
    <div class="center-circle" id="centerCircle" title="Add logo/image">
      <img src="assets/images/logo-icon.png" alt="Logo" style="width:100%; height:100%; border-radius:50%;">
    </div>
  </div>

  <div class="sidebar">
    <div class="tabs">
      <div class="tab active" onclick="showTab('entries')">Entries <span class="badge" id="entriesCount">0</span></div>
      <div class="tab" onclick="showTab('results')">Results <span class="badge" id="resultsCount">0</span></div>
    </div>
    <div class="tab-content" id="entries">
      <div class="editable-list" id="editableList" contenteditable="true" spellcheck="false">
ALICE<br>BOB<br>CHARLIE<br>DAVID<br>EVE<br>FRANK<br>GINA<br>HENRY<br>ISAAC<br>JOVY<br>KIM<br>LIM<br>MEMO<br>NANO<br>OMAR<br>PRINCESS<br>QOMAR<br>RAY<br>SAM<br>TIM<br>URSULA<br>VICTOR<br>WENDY<br>XAVIER<br>YVONNE<br>ZAC
      </div>
      <div class="controls" style="display:flex; justify-content:space-between; margin-top:10px;">
        <button class="btn-enhanced" onclick="shuffleEntries()"><i class="fas fa-random"></i> Shuffle</button>
        <button class="btn-enhanced" onclick="sortEntries()"><i class="fas fa-sort-alpha-up"></i> Sort</button>
      </div>
    </div>
    <div class="tab-content" id="results" style="display:none;">
      <h3>Winner History</h3>
      <ul id="historyList"></ul>
    </div>
  </div>
</div>

<div class="modal" id="winnerModal">
  <div class="modal-content">
    <h2>ðŸŽ‰ Winner ðŸŽ‰</h2>
    <div class="winner-name" id="winnerName"></div>
    <div class="controls" style="justify-content:center; gap:10px;">
      <button class="btn-danger" onclick="confirmWinner()">Confirm & Remove</button>
      <button class="btn-secondary" onclick="closeModal()">Close</button>
    </div>
  </div>
</div>

<audio id="tickSound" src="assets/sounds/tick.mp3"></audio>
<audio id="clapSound" src="assets/sounds/clap.mp3"></audio>
<audio id="shuffleSound" src="assets/sounds/shuffle.mp3"></audio>

<script>
// All your previous JS remains unchanged
const canvas=document.getElementById('wheel'), ctx=canvas.getContext('2d');
let tickSound=document.getElementById('tickSound'), clapSound=document.getElementById('clapSound'), shuffleSound=document.getElementById('shuffleSound');
let audioUnlocked=false, entries=[], history=[], angle=0, spinning=false, selectedIndex=null, wheelImage=null;
let idleRotationSpeed = 0.002;

function animateIdle() { if(!spinning){ angle+=idleRotationSpeed; drawWheel(); } requestAnimationFrame(animateIdle); }
animateIdle();

function unlockAudio(){ if(audioUnlocked) return; [tickSound, clapSound, shuffleSound].forEach(a=>{ a.volume=0.7; a.muted=false; a.play().then(()=>{a.pause();a.currentTime=0;}).catch(()=>{}); }); audioUnlocked=true; }
function soundEnabled(){ return document.getElementById('soundToggle').checked; }

function loadEntries(){ 
  const list=document.getElementById('editableList').innerText.split('\n').map(l=>l.trim()).filter(l=>l); 
  entries=list.map(n=>({name:n})); 
  updateBadges(); drawWheel(); 
}
function updateEditableList(){ document.getElementById('editableList').innerHTML=entries.map(e=>e.name).join('<br>'); }
function updateBadges(){ document.getElementById('entriesCount').textContent=entries.length; document.getElementById('resultsCount').textContent=history.length; }
function updateResultsList(){ document.getElementById('historyList').innerHTML=history.map(n=>`<li>${n}</li>`).join(''); }
function shuffleEntries(){ loadEntries(); entries.sort(()=>Math.random()-0.5); updateEditableList(); if(soundEnabled()) shuffleSound.play(); drawWheel(); }
function sortEntries(){ loadEntries(); entries.sort((a,b)=>a.name.localeCompare(b.name)); updateEditableList(); drawWheel(); }
function showTab(id){document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active')); document.querySelectorAll('.tab-content').forEach(c=>c.style.display='none'); document.getElementById(id).style.display='block'; document.querySelector(`.tab[onclick*="${id}"]`).classList.add('active');}

function resizeCanvas(){ 
  let w;
  if(window.innerWidth <= 991.98){ // mobile
    w = Math.min(window.innerWidth * 0.9, 400); // 90% of viewport width
  } else { // desktop
    const sidebarWidth = document.querySelector('.sidebar').offsetWidth + 60;
    w = Math.min(window.innerWidth - sidebarWidth, 700);
  }
  canvas.width = w; 
  canvas.height = w; 
  drawWheel();
}
window.addEventListener('resize', resizeCanvas); 
resizeCanvas();



function drawWheel(){
  if(!entries.length) return;
  const radius=canvas.width/2;
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.save(); ctx.translate(radius,radius); ctx.rotate(angle);
  const sliceAngle=2*Math.PI/entries.length;
  entries.forEach((e,i)=>{
    const start=i*sliceAngle;
    const gradient=ctx.createLinearGradient(0,0,canvas.width,canvas.height);
    gradient.addColorStop(0,`hsl(${i*360/entries.length},80%,75%)`);
    gradient.addColorStop(1,`hsl(${i*360/entries.length},70%,50%)`);
    ctx.fillStyle=gradient;
    ctx.beginPath(); ctx.moveTo(0,0); ctx.arc(0,0,radius,start,start+sliceAngle); ctx.fill();
    ctx.strokeStyle="#fff"; ctx.lineWidth=2; ctx.beginPath(); ctx.moveTo(0,0); ctx.lineTo(radius*Math.cos(start),radius*Math.sin(start)); ctx.stroke();
    ctx.save(); ctx.rotate(start+sliceAngle/2); ctx.textAlign="right"; ctx.fillStyle="#000"; ctx.font="bold 16px Arial"; ctx.fillText(e.name,radius-12,5); ctx.restore();
  });
  ctx.beginPath(); ctx.arc(0,0,50,0,2*Math.PI); ctx.fillStyle="#eee"; ctx.fill();
  if(wheelImage){ ctx.save(); ctx.clip(); ctx.drawImage(wheelImage,-50,-50,100,100); ctx.restore(); document.getElementById('centerCircle').style.display='none'; } else { document.getElementById('centerCircle').style.display='flex'; }
  ctx.restore();
}

canvas.addEventListener('click',()=>{ unlockAudio(); spinWheel(); });
document.getElementById('editableList').addEventListener('input', loadEntries);

function toggleFullscreen(){ if(!document.fullscreenElement) document.documentElement.requestFullscreen(); else document.exitFullscreen(); }

document.getElementById('centerCircle').addEventListener('click',()=>{
  const input=document.createElement('input'); input.type='file'; input.accept='image/*';
  input.onchange=e=>{ const file=e.target.files[0]; if(!file) return; const img=new Image(); img.onload=()=>{ wheelImage=img; drawWheel(); }; img.src=URL.createObjectURL(file); };
  input.click();
});

// Confetti
const confettiCanvas=document.createElement('canvas'); confettiCanvas.style.position='fixed'; confettiCanvas.style.inset='0'; confettiCanvas.style.pointerEvents='none'; document.body.appendChild(confettiCanvas);
const cctx=confettiCanvas.getContext('2d'); let confetti=[], confettiAnimating=false;
function resizeConfetti(){ confettiCanvas.width=window.innerWidth; confettiCanvas.height=window.innerHeight; }
window.addEventListener('resize',()=>{ resizeCanvas(); resizeConfetti(); }); resizeConfetti();
function launchConfetti(){ for(let i=0;i<120;i++){ confetti.push({x:Math.random()*confettiCanvas.width,y:-20,r:Math.random()*6+4,d:Math.random()*3+2,c:`hsl(${Math.random()*360},100%,50%)`});} if(!confettiAnimating){ confettiAnimating=true; animateConfetti(); } }
function animateConfetti(){ cctx.clearRect(0,0,confettiCanvas.width,confettiCanvas.height); if(document.getElementById('winnerModal').classList.contains('active')){ for(let i=0;i<2;i++){ confetti.push({x:Math.random()*confettiCanvas.width,y:-20,r:Math.random()*6+4,d:Math.random()*3+2,c:`hsl(${Math.random()*360},100%,50%)`});} } confetti.forEach(p=>{ cctx.fillStyle=p.c; cctx.beginPath(); cctx.arc(p.x,p.y,p.r,0,2*Math.PI); cctx.fill(); p.y+=p.d; }); confetti=confetti.filter(p=>p.y<confettiCanvas.height||document.getElementById('winnerModal').classList.contains('active')); if(confetti.length||document.getElementById('winnerModal').classList.contains('active')) requestAnimationFrame(animateConfetti); else confettiAnimating=false; }

// Preselect
let preselectNames = [];
try {
  const input = document.getElementById('preselectName');
  if(input && input.value) preselectNames = JSON.parse(input.value);
} catch(e){ console.warn('Invalid preselect JSON'); }

// Spin logic
function spinWheel() {
  if (spinning || !entries.length) return;
  spinning = true;
  let targetIndex = null;
  for(let name of preselectNames){
    const idx = entries.findIndex(e => e.name.toUpperCase() === name.toUpperCase());
    if(idx !== -1){ targetIndex=idx; break; }
  }
  if(targetIndex === null) targetIndex = Math.floor(Math.random() * entries.length);
  const duration = document.getElementById('spinTime').value * 1000;
  const sliceAngle = 2 * Math.PI / entries.length;
  const startAngle = 0;
  let startTime = null;
  let lastTickIndex = -1;
  const randomExtraRotations = Math.floor(Math.random() * 3 + 5);
  const finalAngle = 3 * Math.PI / 2 - targetIndex * sliceAngle + randomExtraRotations * 2 * Math.PI;

  function animate(ts) {
    if (!startTime) startTime = ts;
    const elapsed = Math.min(ts - startTime, duration);
    const progress = elapsed / duration;
    const easedProgress = 1 - Math.pow(1 - progress, 5);
    angle = startAngle + (finalAngle - startAngle) * easedProgress;
    drawWheel();
    const normalizedAngle = angle % (2 * Math.PI);
    const pointerAngle = (3 * Math.PI / 2 - normalizedAngle + 2 * Math.PI) % (2 * Math.PI);
    const currentIndex = Math.floor(pointerAngle / sliceAngle);
    if (soundEnabled() && currentIndex !== lastTickIndex) {
      tickSound.currentTime = 0;
      tickSound.play();
      lastTickIndex = currentIndex;
    }
    if (progress < 1) requestAnimationFrame(animate);
    else finishSpin();
  }

  requestAnimationFrame(animate);
}

function finishSpin(){
  spinning=false;
  const normalizedAngle=angle%(2*Math.PI);
  const pointerAngle=(3*Math.PI/2-normalizedAngle+2*Math.PI)%(2*Math.PI);
  const sliceAngle=2*Math.PI/entries.length;
  selectedIndex=Math.floor(pointerAngle/sliceAngle);
  const winner=entries[selectedIndex].name;
  history.push(winner); updateBadges(); updateResultsList();
  document.getElementById('winnerName').textContent=winner;
  document.getElementById('winnerModal').classList.add('active');
  if(soundEnabled()){ clapSound.currentTime=0; clapSound.play(); }
  launchConfetti();
}

function confirmWinner(){ entries.splice(selectedIndex,1); selectedIndex=null; drawWheel(); closeModal(); updateEditableList(); updateBadges(); updateResultsList();}
function closeModal(){ document.getElementById('winnerModal').classList.remove('active'); confetti=[]; clapSound.pause(); clapSound.currentTime=0; }

if(sessionStorage.getItem('wheelEntries')){ entries=JSON.parse(sessionStorage.getItem('wheelEntries')); history=JSON.parse(sessionStorage.getItem('winnerHistory')); updateEditableList(); updateBadges(); updateResultsList(); drawWheel(); } else { loadEntries(); }
</script>
</body>
</html>
